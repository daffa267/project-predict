<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>hasil</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="icon" href="./image/P_R_E_D_I_C_T-removebg-preview.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
  <div class="sidebar">
    <ul>
      <li><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-speedometer2"
          viewBox="0 0 16 16">
          <path
            d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4M3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707M2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10m9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5m.754-4.246a.39.39 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.39.39 0 0 0-.029-.518z" />
          <path fill-rule="evenodd"
            d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A8 8 0 0 1 0 10m8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3" />
        </svg><a href="index.html">Beranda</a></li>
      <li><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
          class="bi bi-bag-check-fill" viewBox="0 0 16 16">
          <path fill-rule="evenodd"
            d="M10.5 3.5a2.5 2.5 0 0 0-5 0V4h5zm1 0V4H15v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4h3.5v-.5a3.5 3.5 0 1 1 7 0m-.646 5.354a.5.5 0 0 0-.708-.708L7.5 10.793 6.354 9.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0z" />
        </svg><a href="sell.html">Penjualan</a></li>
      <li><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
          class="bi bi-bar-chart-line-fill" viewBox="0 0 16 16">
          <path
            d="M11 2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v12h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3h1V7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7h1z" />
        </svg><a href="graph.html">Grafik</a></li>
      <li><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
          class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">
          <path
            d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2" />
        </svg><a href="#">Hasil Prediksi</a></li>
      <li><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-octagon"
          viewBox="0 0 16 16">
          <path
            d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1z" />
          <path
            d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" />
        </svg><a href="login.html">Keluar</a></li>
    </ul>
  </div>

  <div class="content">
    <div class="navbar">

      <span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
          class="bi bi-person-circle" viewBox="0 0 16 16">
          <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
          <path fill-rule="evenodd"
            d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1" />
        </svg><a href="profil.html">Bu Imas</a></span>
    </div>
    <div class="dashboard">
      <h1><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
          class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">
          <path
            d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2" />
        </svg>Hasil Prediksi</h1>
      <p><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
          class="bi bi-info-circle-fill" viewBox="0 0 16 16">
          <path
            d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2" />
        </svg> Halaman ini memuat hasil prediksi pemesanan barang.</p>
    </div>

    <div class="file-upload-wrapper">
      <label for="upload-penjualan">Unggah File Penjualan:</label>
      <input type="file" id="upload-penjualan" accept=".xlsx, .xls" />

      <label for="upload-inventaris">Unggah File Inventaris:</label>
      <input type="file" id="upload-inventaris" accept=".xlsx, .xls" />
    </div>

    <button id="process-data">Proses Data</button>

    <div class="prediksi-wrapper">
      <h3>Hasil Prediksi Untuk Pemesanan Barang 2 Minggu Kedepan</h3>
      <table class="prediksi-table" border="1">
        <thead>
          <tr>
            <th>Kategori Barang</th>
            <th>Prediksi (per unit)</th>
            <th>Keterangan (permintaan)</th>
          </tr>
        </thead>
        <tbody id="prediction-table">
          <!-- Data rows akan diisi secara dinamis -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    document.getElementById("process-data").addEventListener("click", processFiles);

    async function processFiles() {
      const penjualanFile = document.getElementById("upload-penjualan").files[0];
      const inventarisFile = document.getElementById("upload-inventaris").files[0];

      if (!penjualanFile || !inventarisFile) {
        alert("Harap unggah kedua file: Penjualan dan Inventaris.");
        return;
      }

      const penjualanData = await readExcel(penjualanFile);
      const inventarisData = await readExcel(inventarisFile);

      const results = calculatePredictions(penjualanData, inventarisData);
      displayResults(results);
    }

    function readExcel(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (event) => {
          const data = event.target.result;
          const workbook = XLSX.read(data, { type: "binary" });
          const sheetName = workbook.SheetNames[0];
          const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
          resolve(jsonData);
        };
        reader.onerror = reject;
        reader.readAsBinaryString(file);
      });
    }

    function calculatePredictions(penjualanData, inventarisData) {
      return penjualanData.map((item) => {
        const namaBarang = item["Nama Barang"];
        const salesData = Object.keys(item)
          .filter((key) => key.startsWith("Minggu"))
          .map((key) => item[key]);

        // Moving Average (2 weeks prediction)
        const movingAverage = salesData.slice(-4).reduce((a, b) => a + b, 0) / 4;

        // Exponential Smoothing (Î± = 0.5)
        const alpha = 0.5;
        let exponentialSmoothing = salesData[0];
        salesData.forEach((value) => {
          exponentialSmoothing = alpha * value + (1 - alpha) * exponentialSmoothing;
        });

        // Final prediction
        const prediksi = Math.round((movingAverage + exponentialSmoothing) / 2);

        // Determine category (Tinggi, Sedang, Rendah)
        let keterangan;
        if (prediksi > 100) {
          keterangan = "Tinggi";
        } else if (prediksi >= 50) {
          keterangan = "Sedang";
        } else if (prediksi >= 20) {
          keterangan = "Rendah";
        } else {
          keterangan = "Sangat Rendah";
        }

        return {
          namaBarang,
          prediksi,
          keterangan,
        };
      });
    }

    function displayResults(results) {
      const tableBody = document.getElementById("prediction-table");
      tableBody.innerHTML = "";

      results.forEach((result) => {
        const row = document.createElement("tr");

        const namaBarangCell = document.createElement("td");
        namaBarangCell.textContent = result.namaBarang;

        const prediksiCell = document.createElement("td");
        prediksiCell.textContent = result.prediksi;

        const keteranganCell = document.createElement("td");
        keteranganCell.textContent = result.keterangan;

        row.appendChild(namaBarangCell);
        row.appendChild(prediksiCell);
        row.appendChild(keteranganCell);

        tableBody.appendChild(row);
      });
    }
  </script>

</body>

</html>